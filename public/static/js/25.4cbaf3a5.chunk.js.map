{"version":3,"sources":["views/base/EditStory.js"],"names":["storage","firebase","db","firestore","collection","storyID","EditStory","props","getFiles","fullPath","Promise","resolve","reject","ref","listAll","then","res","files","items","forEach","itemRef","push","catch","error","showNotification","NOTIFICATION","ERROR","toString","onNameChange","input","currentTarget","setState","name","value","onImageChange","event","target","getImagePreview","preview","file","onAvatarsChange","a","path","delete","length","avatars","state","onFileChange","onCategoryChange","checked","id","categories","index","findIndex","category","holder","removeAvatar","avatar","handleSubmit","e","preventDefault","cover","defaultIcon","explorePageIcon","recommendedTitleIcon","avatarStyles","promises","categoryIDs","isLoading","doc","update","uploadFile","deleteFile","all","r","updateStoryName","SUCCESS","backToList","image","reader","FileReader","readAsDataURL","onloadend","result","bind","this","console","log","history","pathname","location","undefined","get","exists","data","description","includes","getDownloadURL","url","endsWith","directory","filename","uploadTask","put","on","TaskEvent","STATE_CHANGED","code","serverResponse","snapshot","downloadURL","className","color","style","width","height","xs","onSubmit","md","row","placeholder","onChange","accept","htmlFor","variant","multiple","map","type","custom","minHeight","src","shape","size","onClick","param","content","freeSet","cilX","cilFile","Component"],"mappings":"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","file":"static/js/25.4cbaf3a5.chunk.js","sourcesContent":["import React, {Component} from 'react'\r\nimport Skeleton from 'react-loading-skeleton';\r\nimport './style.css'\r\nimport firebase from 'firebase/app'\r\nimport 'firebase/storage'\r\nimport 'firebase/firestore'\r\nimport {\r\n    CButton,\r\n    CCard,\r\n    CCardBody,\r\n    CCardHeader,\r\n    CCol,\r\n    CForm,\r\n    CFormGroup,\r\n    CInput,\r\n    CInputFile,\r\n    CLabel,\r\n    CRow,\r\n    CInputCheckbox,\r\n    CImg, CSpinner\r\n} from '@coreui/react'\r\nimport CIcon from '@coreui/icons-react'\r\nimport {showNotification, NOTIFICATION, updateStoryName} from \"../../reusable/Utility\";\r\nimport {freeSet} from \"@coreui/icons\";\r\n\r\n\r\n// const [collapsed, setCollapsed] = React.useState(true)\r\n// const [showElements, setShowElements] = React.useState(true)\r\n\r\nconst directory = '_dev';\r\nconst storage = firebase.storage();\r\nconst db = firebase.firestore().collection(\"stories_dev\");\r\n\r\nlet storyID = '';\r\n\r\nclass EditStory extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        if (props.location.state === undefined) {\r\n            showNotification(NOTIFICATION.ERROR, 'Story ID not found');\r\n            this.backToList();\r\n        } else {\r\n            storyID = props.location.state.id\r\n        }\r\n\r\n        this.state = {\r\n            isLoading: true,\r\n            name: '',\r\n            categories: [\r\n                {\r\n                    id: '5QEVhrCEvITIiaBFIE8f',\r\n                    name: 'Thriller',\r\n                    checked: false\r\n                },\r\n                {\r\n                    id: 'Xj95jggxg9D4RFGy0mdU',\r\n                    name: 'Romance',\r\n                    checked: false\r\n                },\r\n                {\r\n                    id: 'pQ1Qbg8qEwixkWYUh53q',\r\n                    name: 'Fantasy',\r\n                    checked: false\r\n                }\r\n            ],\r\n            cover: {\r\n                file: null,\r\n                preview: null\r\n            },\r\n            defaultIcon: {\r\n                file: null,\r\n                preview: null\r\n            },\r\n            explorePageIcon: {\r\n                file: null,\r\n                preview: null\r\n            },\r\n            recommendedTitleIcon: {\r\n                file: null,\r\n                preview: null\r\n            },\r\n            avatars: [],\r\n            avatarStyles: {\r\n                file: null,\r\n                preview: null\r\n            },\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        db.doc(storyID).get().then(async (doc) => {\r\n            if (doc.exists) {\r\n                const { name, description, categories } = doc.data();\r\n                const path = `_dev/stories/${storyID}`;\r\n                let holder = [...this.state.categories];\r\n\r\n                holder.forEach(category => {\r\n                    if (categories.includes(category.id)) category.checked = true;\r\n                });\r\n\r\n                this.setState({ isLoading: false, name: name, categories: [...holder] });\r\n\r\n                storage.ref(`${path}/cover.png`).getDownloadURL()\r\n                    .then((url) => {\r\n                        this.setState({ cover: {file: null, preview: url} });\r\n                    }).catch((error) => { showNotification(NOTIFICATION.ERROR, error.toString()); });\r\n\r\n                storage.ref(`${path}/icon.png`).getDownloadURL()\r\n                    .then((url) => {\r\n                        this.setState({ defaultIcon: {file: null, preview: url} });\r\n                    }).catch((error) => { showNotification(NOTIFICATION.ERROR, error.toString()); });\r\n\r\n                storage.ref(`${path}/rect2x_icon.png`).getDownloadURL()\r\n                    .then((url) => {\r\n                        this.setState({ explorePageIcon: {file: null, preview: url} });\r\n                    }).catch((error) => { showNotification(NOTIFICATION.ERROR, error.toString()); });\r\n\r\n                storage.ref(`${path}/rect_icon.png`).getDownloadURL()\r\n                    .then((url) => {\r\n                        this.setState({ recommendedTitleIcon: {file: null, preview: url} });\r\n                    }).catch((error) => { showNotification(NOTIFICATION.ERROR, error.toString()); });\r\n\r\n                const avatars = await this.getFiles(`${path}/Avatars`);\r\n                avatars.forEach(avatar => {\r\n                    if (avatar.endsWith('png')) {\r\n                        storage.ref(avatar).getDownloadURL()\r\n                            .then((url) => {\r\n                                // this.setState({ recommendedTitleIcon: {file: null, preview: url} });\r\n                                this.setState({ avatars: [...this.state.avatars, { file: null, preview: url, path: avatar, delete: false }] });\r\n                            }).catch((error) => { showNotification(NOTIFICATION.ERROR, error.toString()); });\r\n                    }\r\n                });\r\n            } else {\r\n                showNotification(NOTIFICATION.ERROR, 'Invalid book ID!');\r\n                this.backToList();\r\n            }\r\n        }).catch((error) => {\r\n            showNotification(NOTIFICATION.ERROR, `Error: ${error.toString()}`);\r\n            this.backToList();\r\n        });\r\n    }\r\n\r\n    getFiles = (fullPath) => {\r\n        return new Promise((resolve, reject) => {\r\n            storage.ref(fullPath).listAll()\r\n                .then((res) => {\r\n                    let files = [];\r\n                    res.items.forEach((itemRef) => {\r\n                        files.push(itemRef.fullPath);\r\n                    });\r\n                    resolve(files);\r\n                }).catch((error) => {\r\n                showNotification(NOTIFICATION.ERROR, error.toString());\r\n                resolve([]);\r\n            });\r\n        });\r\n    };\r\n\r\n    onNameChange = ({currentTarget: input}) => {\r\n        this.setState({name: input.value});\r\n    };\r\n    onImageChange = event => {\r\n        if (event.target.files[0]) {\r\n            this.getImagePreview(event.target.files[0]).then(preview => {\r\n                this.setState({[event.target.name]: {file: event.target.files[0], preview: preview}});\r\n            });\r\n        }\r\n    };\r\n    onAvatarsChange = async event => {\r\n        let files = [];\r\n        for (const file of event.target.files) {\r\n            let preview = await this.getImagePreview(file);\r\n            files.push({\r\n                file: file,\r\n                preview: preview,\r\n                path: null,\r\n                delete: false\r\n            });\r\n        }\r\n        if (files.length > 0) this.setState({avatars: [...this.state.avatars, ...files]});\r\n    };\r\n    onFileChange = event => {\r\n        this.setState({[event.target.name]: {file: event.target.files[0]}});\r\n    };\r\n    onCategoryChange = event => {\r\n        let {checked, id} = event.target;\r\n        let {categories} = this.state;\r\n\r\n        const index = categories.findIndex(category => category.id === id);\r\n        let holder = [...categories];\r\n        holder[index].checked = checked;\r\n        this.setState({categories: [...holder]});\r\n    };\r\n\r\n    removeAvatar = (preview) => {\r\n        let holder = [...this.state.avatars];\r\n        holder.forEach(avatar => {\r\n            if (avatar.preview === preview) avatar.delete = true;\r\n        });\r\n        this.setState({ avatars: [...holder] });\r\n    }\r\n\r\n    handleSubmit = e => {\r\n        e.preventDefault();\r\n\r\n        const {\r\n            name,\r\n            categories,\r\n            cover,\r\n            defaultIcon,\r\n            explorePageIcon,\r\n            recommendedTitleIcon,\r\n            avatars,\r\n            avatarStyles\r\n        } = this.state;\r\n\r\n        let promises = [];\r\n\r\n        let categoryIDs = [];\r\n        categories.forEach(category => {\r\n            if (category.checked) categoryIDs.push(category.id);\r\n        })\r\n        if (categoryIDs.length === 0) {\r\n            showNotification(NOTIFICATION.ERROR, 'At least 1 category is required');\r\n            return;\r\n        }\r\n\r\n        this.setState({isLoading: true});\r\n\r\n        // Add a new document with a generated id.\r\n        db.doc(storyID).update({\r\n            name: name,\r\n            categories: categoryIDs\r\n        }).then(() => {\r\n            let path = `${directory}/stories/${storyID}`;\r\n\r\n            if (cover.file) promises.push(this.uploadFile(path, cover.file, 'cover.png'));\r\n            if (defaultIcon.file) promises.push(this.uploadFile(path, defaultIcon.file, 'icon.png'));\r\n            if (explorePageIcon.file) promises.push(this.uploadFile(path, explorePageIcon.file, 'rect2x_icon.png'));\r\n            if (recommendedTitleIcon.file) promises.push(this.uploadFile(path, recommendedTitleIcon.file, 'rect_icon.png'));\r\n            if (avatarStyles.file) promises.push(this.uploadFile(`${path}/Avatars`, avatarStyles.file, 'style.txt'));\r\n\r\n            avatars.forEach(avatar => {\r\n                if (avatar.file && !avatar.delete) {\r\n                    promises.push(this.uploadFile(`${path}/Avatars`, avatar.file));\r\n                } else if (!avatar.file && avatar.delete) {\r\n                    promises.push(this.deleteFile(avatar.path));\r\n                }\r\n            });\r\n\r\n            Promise.all(promises).then(r => {\r\n                updateStoryName(storyID, name);\r\n                showNotification(NOTIFICATION.SUCCESS, 'Book updated successfully!');\r\n                this.backToList();\r\n            }).catch(e => {\r\n                showNotification(NOTIFICATION.ERROR, 'Failed to upload files. Try again!');\r\n                this.setState({isLoading: false});\r\n            });\r\n\r\n        }).catch((error) => {\r\n            showNotification(NOTIFICATION.ERROR, 'Something went wrong. Try again!');\r\n            this.setState({isLoading: false});\r\n        });\r\n    };\r\n\r\n    //Handle waiting to upload each file using promise\r\n    uploadFile(directory, file, filename = null) {\r\n        return new Promise(function (resolve, reject) {\r\n            filename = filename ? filename : file.name ;\r\n            const storageRef = firebase.storage().ref(directory + \"/\" + filename);\r\n            //Upload file\r\n            let uploadTask = storageRef.put(file);\r\n            // Listen for state changes, errors, and completion of the upload.\r\n            uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,\r\n                null,\r\n                (error) => {\r\n                    // A full list of error codes is available at\r\n                    // https://firebase.google.com/docs/storage/web/handle-errors\r\n                    switch (error.code) {\r\n                        case 'storage/unauthorized':\r\n