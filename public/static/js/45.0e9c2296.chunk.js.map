{"version":3,"sources":["views/base/Stories.js"],"names":["db","firebase","storage","ref","firestore","collection","fields","key","label","_style","width","sorter","filter","seasonsFields","Tables","props","showSeasons","data","setState","isSeasonLoading","storyID","id","storyName","name","episodes","seasons","index","doc","orderBy","get","then","querySnapshot","forEach","push","seasonIndex","showEpisodes","isEpisodeLoading","seasonID","seasonName","state","episodeIndex","addNewBook","saveState","history","pathname","addNewSeason","isLoading","add","createdAt","Date","now","docRef","season","showNotification","NOTIFICATION","SUCCESS","catch","error","ERROR","addNewEpisodes","isPublished","likes","episode","editBook","editEpisode","episodeID","closeSeasons","closeEpisodes","my_state","getState","stories","this","className","color","style","height","variant","onClick","content","freeSet","cilPlus","size","items","onRowClick","clickableRows","tableFilter","hover","pagination","responsive","itemsPerPage","scopedSlots","item","shape","cilArrowRight","border","Component"],"mappings":"+VAoBMA,GADUC,IAASC,UAAUC,MACxBF,IAASG,YAAYC,WAAW,gBAErCC,EAAS,CACX,OACA,CAAEC,IAAK,SAAUC,MAAO,GAAIC,OAAQ,CAAEC,MAAO,MAAOC,QAAQ,EAAOC,QAAQ,IAEzEC,EAAgB,CAAC,QAEjBC,E,kDACF,WAAYC,GAAQ,IAAD,uBACf,cAAMA,IAsCVC,YAAc,SAACC,GACX,EAAKC,SAAS,CAACC,iBAAiB,EAAMC,QAASH,EAAKI,GAAIC,UAAWL,EAAKM,KAAMC,SAAU,OAExF,IAAIC,EAAU,GAAIC,EAAQ,EAC1B1B,EAAG2B,IAAIV,EAAKI,IAAIhB,WAAW,WAAWuB,QAAQ,aAAaC,MAAMC,MAAK,SAACC,GACnEA,EAAcC,SAAQ,SAACL,GACnBF,EAAQQ,KAAK,CACTZ,GAAIM,EAAIN,GACRE,KAAMI,EAAIV,OAAOM,KACjBG,MAAOC,EAAIV,OAAOS,QAElBA,EAAQC,EAAIV,OAAOS,QAAOA,EAAQC,EAAIV,OAAOS,UAErD,EAAKR,SAAS,CAACC,iBAAiB,EAAOM,QAASA,EAASS,YAAaR,QApD3D,EAwDnBS,aAAe,SAAClB,GACZ,EAAKC,SAAS,CAACkB,kBAAkB,EAAMC,SAAUpB,EAAKI,GAAIiB,WAAYrB,EAAKM,OADtD,IAGdH,EAAW,EAAKmB,MAAhBnB,QAEHI,EAAW,GAAIE,EAAQ,EAC3B1B,EAAG2B,IAAIP,GAASf,WAAW,WAAWsB,IAAIV,EAAKI,IAAIhB,WAAW,YAAYuB,QAAQ,aAAaC,MAAMC,MAAK,SAACC,GACvGA,EAAcC,SAAQ,SAACL,GACnBH,EAASS,KAAK,CACVZ,GAAIM,EAAIN,GACRE,KAAMI,EAAIV,OAAOM,KACjBG,MAAOC,EAAIV,OAAOS,QAElBA,EAAQC,EAAIV,OAAOS,QAAOA,EAAQC,EAAIV,OAAOS,UAErD,EAAKR,SAAS,CAACkB,kBAAkB,EAAOZ,SAAUA,EAAUgB,aAAcd,QAvE/D,EA2EnBe,WAAa,WACTC,YAAU,EAAKH,OACf,EAAKxB,MAAM4B,QAAQV,KAAK,CACpBW,SAAU,aACVL,MAAO,EAAKA,SA/ED,EAkFnBM,aAAe,WAAO,IAAD,EACc,EAAKN,MAA7BnB,EADU,EACVA,QAASc,EADC,EACDA,YAChB,EAAKhB,SAAS,CAAC4B,WAAW,IAE1B9C,EAAG2B,IAAIP,GAASf,WAAW,WAAW0C,IAAI,CACtCxB,KAAK,UAAD,OAAYW,EAAc,GAC9BR,MAAOQ,EAAc,EACrBc,UAAWC,KAAKC,QAEfpB,MAAK,SAACqB,GACH,IAAIC,EAAS,CAAC,CACV/B,GAAI8B,EAAO9B,GACXE,KAAK,UAAD,OAAYW,EAAc,GAC9BR,MAAOQ,EAAc,IAEzB,EAAKhB,SAAS,CAACO,QAAQ,GAAD,mBAAM,EAAKc,MAAMd,SAAY2B,GAASlB,YAAaA,EAAY,EAAGY,WAAW,IACnGO,YAAiBC,IAAaC,QAAS,iCAE1CC,OAAM,SAACC,GACJJ,YAAiBC,IAAaI,MAAO,oCACrC,EAAKxC,SAAS,CAAC4B,WAAW,QAtGnB,EA0GnBa,eAAiB,WAAO,IAAD,EACwB,EAAKpB,MAAzCnB,EADY,EACZA,QAASiB,EADG,EACHA,SAAUG,EADP,EACOA,aAC1B,EAAKtB,SAAS,CAAC4B,WAAW,IAEd9C,EACP2B,IAAIP,GACJf,WAAW,WACXsB,IAAIU,GACJhC,WAAW,YAEZ0C,IAAI,CACJxB,KAAK,WAAD,OAAaiB,EAAa,GAC9BoB,aAAa,EACblC,MAAOc,EAAe,EACtBqB,MAAO,EACPb,UAAWC,KAAKC,QACjBpB,MAAK,SAACqB,GACL,IAAIW,EAAU,CAAC,CACXzC,GAAI8B,EAAO9B,GACXE,KAAK,WAAD,OAAaiB,EAAa,GAC9Bd,MAAOc,EAAe,IAE1B,EAAKtB,SAAS,CAACM,SAAS,GAAD,mBAAM,EAAKe,MAAMf,UAAasC,GAAUtB,aAAcA,EAAa,EAAGM,WAAW,IACxGO,YAAiBC,IAAaC,QAAS,kCACxCC,OAAM,SAACC,GACNJ,YAAiBC,IAAaI,MAAO,oCACrC,EAAKxC,SAAS,CAAC4B,WAAW,QApIf,EAwInBiB,SAAW,SAAC9C,GACRyB,YAAU,EAAKH,OACf,EAAKxB,MAAM4B,QAAQV,KAAK,CACpBW,SAAU,cACVL,MAAO,CAAClB,GAAIJ,EAAKI,OA5IN,EAgJnB2C,YAAc,SAAC/C,GACXyB,YAAU,EAAKH,OACf,EAAKxB,MAAM4B,QAAQV,KAAK,CACpBW,SAAU,gBACVL,MAAM,2BAAK,EAAKA,OAAX,IAAkB0B,UAAWhD,EAAKI,QApJ5B,EAwJnB6C,aAAe,WACX,EAAKhD,SAAS,CAACO,QAAS,KAAMD,SAAU,QAzJzB,EA4JnB2C,cAAgB,WACZ,EAAKjD,SAAS,CAACM,SAAU,QA3JzB,IAAI4C,EAAWC,cAFA,OAIE,OAAbD,GACA,EAAK7B,MAAQ6B,EACb1B,YAAU,OAEV,EAAKH,MAAQ,CACTO,WAAW,EACX3B,iBAAiB,EACjBiB,kBAAkB,EAClBd,UAAW,KACXF,QAAS,KACTkB,WAAY,KACZD,SAAU,KACVH,YAAa,EACbM,aAAc,EACd8B,QAAS,GACT7C,QAAS,KACTD,SAAU,KACVyC,UAAW,MArBJ,E,qDA0BnB,WAAqB,IAAD,OACZK,EAAU,GACdtE,EAAG4B,QAAQ,aAAaC,MAAMC,MAAK,SAACC,GAChCA,EAAcC,SAAQ,SAACL,GACnB2C,EAAQrC,KAAK,CACTZ,GAAIM,EAAIN,GACRE,KAAMI,EAAIV,OAAOM,UAGzB,EAAKL,SAAS,CAAC4B,WAAW,EAAOwB,QAASA,S,oBA6HlD,WAAU,IAAD,SAC8EC,KAAKhC,MAAjFO,EADF,EACEA,UAAW3B,EADb,EACaA,gBAAiBiB,EAD9B,EAC8BA,iBAAkBkC,EADhD,EACgDA,QAAS7C,EADzD,EACyDA,QAASD,EADlE,EACkEA,SAEvE,OACI,cAAC,WAAD,UACI,mCAEQsB,EACI,qBAAK0B,UAAU,cAAf,SACI,cAAC,KAAD,CACIA,UAAU,OACVC,MAAM,UACNC,MAAO,CAAChE,MAAO,OAAQiE,OAAQ,YAIvC,eAAC,KAAD,WACI,cAAC,IAAD,CAAMH,UAAU,MAAhB,SACI,eAAC,IAAD,CAAOA,UAAU,QAAjB,UACI,eAAC,IAAD,CAAaA,UAAU,iCAAvB,UACI,yCACA,cAAC,IAAD,CAASI,QAAQ,UAAUC,QAASN,KAAK9B,WAAYgC,MAAM,UAA3D,SACI,cAAC,IAAD,CAAOK,QAASC,IAAQC,QAASC,KAAK,YAG9C,cAAC,IAAD,UACI,cAAC,IAAD,CACIC,MAAOZ,EACPhE,OAAQA,EACR6E,WAAYZ,KAAKvD,YACjBoE,eAAe,EACfC,aAAW,EACXC,OAAK,EACLC,YAAU,EACVC,YAAU,EACVC,aAAc,IACdC,YAAa,CACT,OACI,SAACC,EAAMjE,GACH,OACI,oBAAI8C,UAAU,mBAAd,SACI,cAAC,IAAD,CACIC,MAAM,UACNG,QAAQ,QACRgB,MAAM,OACNX,KAAK,KACLJ,QAAS,kBAAM,EAAKd,SAAS4B,IALjC,SAOI,cAAC,IAAD,CAAOpE,KAAK,YAAY0D,KAAK,sBAYjE9D,EACI,qBAAKqD,UAAU,cAAf,SACI,cAAC,KAAD,CACIA,UAAU,MACVC,MAAM,UACNC,MAAO,CAAChE,MAAO,OAAQiE,OAAQ,YAGvClD,GACJ,cAAC,IAAD,CAAM+C,UAAU,MAAhB,SACI,eAAC,IAAD,CAAOA,UAAU,QAAjB,UACI,eAAC,IAAD,CAAaA,UAAU,iCAAvB,UACI,yCACA,gCACI,cAAC,IAAD,CAASK,QAASN,KAAK1B,aAAc+B,QAAQ,UACpCH,MAAM,UADf,SAEI,cAAC,IAAD,CAAOK,QAASC,IAAQC,QAASC,KAAK,SAE1C,cAAC,IAAD,CAAST,UAAW,OAAQK,QAASN,KAAKL,aACjCU,QAAQ,UAAUH,MAAM,SADjC,SAEI,cAAC,IAAD,CAAOK,QAASC,IAAQc,cAAeZ,KAAK,eAIxD,cAAC,IAAD,UACI,cAAC,IAAD,CACIC,MAAOzD,EACPnB,OAAQO,EACRsE,WAAYZ,KAAKpC,aACjBiD,eAAe,EACfC,aAAW,EACXC,OAAK,EACLQ,QAAM,EACNP,YAAU,EACVC,YAAU,EACVC,aAAc,aAS9BrD,EACI,qBAAKoC,UAAU,cAAf,SACI,cAAC,KAAD,CACIA,UAAU,MACVC,MAAM,UACNC,MAAO,CAAChE,MAAO,OAAQiE,OAAQ,YAGvCnD,GACJ,cAAC,IAAD,CAAMgD,UAAU,MAAhB,SACI,eAAC,IAAD,CAAOA,UAAU,QAAjB,UACI,eAAC,IAAD,CAAaA,UAAU,iCAAvB,UACI,0CACA,gCACI,cAAC,IAAD,CAASK,QAASN,KAAKZ,eAAgBiB,QAAQ,UACtCH,MAAM,UADf,SAEI,cAAC,IAAD,CAAOK,QAASC,IAAQC,QAASC,KAAK,SAE1C,cAAC,IAAD,CAAST,UAAW,OAAQK,QAASN,KAAKJ,cACjCS,QAAQ,UAAUH,MAAM,SADjC,SAEI,cAAC,IAAD,CAAOK,QAASC,IAAQc,cAAeZ,KAAK,eAIxD,cAAC,IAAD,UACI,cAAC,IAAD,CACIC,MAAO1D,EACPlB,OAAQA,EACR+E,aAAW,EACXC,OAAK,EACLC,YAAU,EACVC,YAAU,EACVC,aAAc,IACdC,YAAa,CACT,OACI,SAACC,EAAMjE,GACH,OACI,oBAAI8C,UAAU,mBAAd,SACI,cAAC,IAAD,CACIC,MAAM,UACNG,QAAQ,QACRgB,MAAM,OACNX,KAAK,KACLJ,QAAS,kBAAM,EAAKb,YAAY2B,IALpC,SAOI,cAAC,IAAD,CAAOpE,KAAK,YAAY0D,KAAK,iC,GAtTpFc,aA4UNjF","file":"static/js/45.0e9c2296.chunk.js","sourcesContent":["import React, {Component, Fragment} from 'react'\nimport firebase from 'firebase/app'\nimport {saveState, getState, showNotification, NOTIFICATION} from '../../reusable/Utility';\nimport 'firebase/firestore'\nimport 'firebase/storage'\n\nimport {\n    CSpinner,\n    CCard,\n    CCardBody,\n    CCardHeader,\n    CCol,\n    CDataTable,\n    CRow,\n    CButton\n} from '@coreui/react'\nimport {CIcon} from \"@coreui/icons-react\";\nimport {freeSet} from '@coreui/icons'\n\nconst storage = firebase.storage().ref();\nconst db = firebase.firestore().collection(\"stories_dev\");\n\nconst fields = [\n    'name',\n    { key: 'action', label: '', _style: { width: '1%'}, sorter: false, filter: false}\n]\nconst seasonsFields = ['name']\n\nclass Tables extends Component {\n    constructor(props) {\n        super(props);\n        let my_state = getState();\n\n        if (my_state !== null) {\n            this.state = my_state;\n            saveState(null);\n        } else {\n            this.state = {\n                isLoading: true,\n                isSeasonLoading: false,\n                isEpisodeLoading: false,\n                storyName: null,\n                storyID: null,\n                seasonName: null,\n                seasonID: null,\n                seasonIndex: 1,\n                episodeIndex: 1,\n                stories: [],\n                seasons: null,\n                episodes: null,\n                episodeID: null\n            };\n        }\n    }\n\n    componentDidMount() {\n        let stories = [];\n        db.orderBy(\"createdAt\").get().then((querySnapshot) => {\n            querySnapshot.forEach((doc) => {\n                stories.push({\n                    id: doc.id,\n                    name: doc.data().name\n                });\n            });\n            this.setState({isLoading: false, stories: stories});\n        });\n    }\n\n    showSeasons = (data) => {\n        this.setState({isSeasonLoading: true, storyID: data.id, storyName: data.name, episodes: null});\n\n        let seasons = [], index = 0;\n        db.doc(data.id).collection('seasons').orderBy(\"createdAt\").get().then((querySnapshot) => {\n            querySnapshot.forEach((doc) => {\n                seasons.push({\n                    id: doc.id,\n                    name: doc.data().name,\n                    index: doc.data().index\n                });\n                if (index < doc.data().index) index = doc.data().index;\n            });\n            this.setState({isSeasonLoading: false, seasons: seasons, seasonIndex: index});\n        });\n    };\n\n    showEpisodes = (data) => {\n        this.setState({isEpisodeLoading: true, seasonID: data.id, seasonName: data.name});\n\n        const {storyID} = this.state;\n\n        let episodes = [], index = 0;\n        db.doc(storyID).collection('seasons').doc(data.id).collection('episodes').orderBy(\"createdAt\").get().then((querySnapshot) => {\n            querySnapshot.forEach((doc) => {\n                episodes.push({\n                    id: doc.id,\n                    name: doc.data().name,\n                    index: doc.data().index\n                });\n                if (index < doc.data().index) index = doc.data().index;\n            });\n            this.setState({isEpisodeLoading: false, episodes: episodes, episodeIndex: index});\n        });\n    };\n\n    addNewBook = () => {\n        saveState(this.state);\n        this.props.history.push({\n            pathname: '/add-story',\n            state: this.state\n        });\n    };\n    addNewSeason = () => {\n        const {storyID, seasonIndex} = this.state;\n        this.setState({isLoading: true});\n\n        db.doc(storyID).collection('seasons').add({\n            name: `Season ${seasonIndex + 1}`,\n            index: seasonIndex + 1,\n            createdAt: Date.now()\n        })\n            .then((docRef) => {\n                let season = [{\n                    id: docRef.id,\n                    name: `Season ${seasonIndex + 1}`,\n                    index: seasonIndex + 1\n                }];\n                this.setState({seasons: [...this.state.seasons, ...season], seasonIndex: seasonIndex+1, isLoading: false});\n                showNotification(NOTIFICATION.SUCCESS, 'Season added successfully!');\n            })\n            .catch((error) => {\n                showNotification(NOTIFICATION.ERROR, 'Something went wrong. Try again!');\n                this.setState({isLoading: false});\n            });\n    };\n\n    addNewEpisodes = () => {\n        const {storyID, seasonID, episodeIndex } = this.state;\n        this.setState({isLoading: true});\n\n        const ref = db\n            .doc(storyID)\n            .collection('seasons')\n            .doc(seasonID)\n            .collection('episodes');\n\n        ref.add({\n            name: `Episode ${episodeIndex+1}`,\n            isPublished: false,\n            index: episodeIndex + 1,\n            likes: 0,\n            createdAt: Date.now()\n        }).then((docRef) => {\n            let episode = [{\n                id: docRef.id,\n                name: `Episode ${episodeIndex+1}`,\n                index: episodeIndex + 1,\n            }];\n            this.setState({episodes: [...this.state.episodes, ...episode], episodeIndex: episodeIndex+1, isLoading: false});\n            showNotification(NOTIFICATION.SUCCESS, 'Episode added successfully!');\n        }).catch((error) => {\n            showNotification(NOTIFICATION.ERROR, 'Something went wrong. Try again!');\n            this.setState({isLoading: false});\n        });\n    };\n\n    editBook = (data) => {\n        saveState(this.state);\n        this.props.history.push({\n            pathname: '/edit-story',\n            state: {id: data.id}\n        });\n    }\n\n    editEpisode = (data) => {\n        saveState(this.state);\n        this.props.history.push({\n            pathname: '/edit-episode',\n            state: {...this.state, episodeID: data.id}\n        });\n    }\n\n    closeSeasons = () => {\n        this.setState({seasons: null, episodes: null});\n    }\n\n    closeEpisodes = () => {\n        this.setState({episodes: null});\n    }\n\n    render() {\n        const {isLoading, isSeasonLoading, isEpisodeLoading, stories, seasons, episodes} = this.state;\n\n        return (\n            <Fragment>\n                <>\n                    {\n                        isLoading ? (\n                            <div className=\"text-center\">\n                                <CSpinner\n                                    className=\"mt-5\"\n                                    color=\"primary\"\n                                    style={{width: '4rem', height: '4rem'}}\n                                />\n                            </div>\n                        ) : (\n                            <CRow>\n                                <CCol className=\"p-0\">\n                                    <CCard className=\"h-100\">\n                                        <CCardHeader className=\"d-flex justify-content-between\">\n                                            <h2>Stories</h2>\n                                            <CButton variant=\"outline\" onClick={this.addNewBook} color=\"primary\">\n                                                <CIcon content={freeSet.cilPlus} size=\"lg\"/>\n                                            </CButton>\n                                        </CCardHeader>\n                                        <CCardBody>\n                                            <CDataTable\n                                                items={stories}\n                                                fields={fields}\n                                                onRowClick={this.showSeasons}\n                                                clickableRows={true}\n                                                tableFilter\n                                                hover\n                                                pagination\n                                                responsive\n                                                itemsPerPage={100}\n                                                scopedSlots={{\n                                                    'action':\n                                                        (item, index) => {\n                                                            return (\n                                                                <td className=\"py-2 text-center\">\n                                                                    <CButton\n                                                                        color=\"primary\"\n                                                                        variant=\"ghost\"\n                                                                        shape=\"pill\"\n                                                                        size=\"sm\"\n                                                                        onClick={() => this.editBook(item)}\n                                                                    >\n                                                                        <CIcon name=\"cilPencil\" size=\"sm\"/>\n                                                                    </CButton>\n                                                                </td>\n                                                            )\n                                                        }\n                                                }}\n                                            />\n                                        </CCardBody>\n                                    </CCard>\n                                </CCol>\n\n                                {\n                                    isSeasonLoading ? (\n                                        <div className=\"text-center\">\n                                            <CSpinner\n                                                className=\"m-5\"\n                                                color=\"primary\"\n                                                style={{width: '2rem', height: '2rem'}}\n                                            />\n                                        </div>\n                                    ) : seasons && (\n                                    <CCol className=\"p-0\">\n                                        <CCard className=\"h-100\">\n                                            <CCardHeader className=\"d-flex justify-content-between\">\n                                                <h2>Seasons</h2>\n                                                <div>\n                                                    <CButton onClick={this.addNewSeason} variant=\"outline\"\n                                                             color=\"primary\">\n                                                        <CIcon content={freeSet.cilPlus} size=\"lg\"/>\n                                                    </CButton>\n                                                    <CButton className={'ml-1'} onClick={this.closeSeasons}\n                                                             variant=\"outline\" color=\"danger\">\n                                                        <CIcon content={freeSet.cilArrowRight} size=\"lg\"/>\n                                                    </CButton>\n                                                </div>\n                                            </CCardHeader>\n                                            <CCardBody>\n                                                <CDataTable\n                                                    items={seasons}\n                                                    fields={seasonsFields}\n                                                    onRowClick={this.showEpisodes}\n                                                    clickableRows={true}\n                                                    tableFilter\n                                                    hover\n                                                    border\n                                                    pagination\n                                                    responsive\n                                                    itemsPerPage={100}\n                                                />\n                                            </CCardBody>\n                                        </CCard>\n                                    </CCol>\n                                )}\n\n\n                                {\n                                    isEpisodeLoading ? (\n                                        <div className=\"text-center\">\n                                            <CSpinner\n                                                className=\"m-5\"\n                                                color=\"primary\"\n                                                style={{width: '2rem', height: '2rem'}}\n                                            />\n                                        </div>\n                                    ) : episodes && (\n                                    <CCol className=\"p-0\">\n                                        <CCard className=\"h-100\">\n                                            <CCardHeader className=\"d-flex justify-content-between\">\n                                                <h2>Episodes</h2>\n                                                <div>\n                                                    <CButton onClick={this.addNewEpisodes} variant=\"outline\"\n                                                             color=\"primary\">\n                                                        <CIcon content={freeSet.cilPlus} size=\"lg\"/>\n                                                    </CButton>\n                                                    <CButton className={'ml-1'} onClick={this.closeEpisodes}\n                                                             variant=\"outline\" color=\"danger\">\n                                                        <CIcon content={freeSet.cilArrowRight} size=\"lg\"/>\n                                                    </CButton>\n                                                </div>\n                                            </CCardHeader>\n                                            <CCardBody>\n                                                <CDataTable\n                                                    items={episodes}\n                                                    fields={fields}\n                                                    tableFilter\n                                                    hover\n                                                    pagination\n                                                    responsive\n                                                    itemsPerPage={100}\n                                                    scopedSlots={{\n                                                        'action':\n                                                            (item, index) => {\n                                                                return (\n                                                                    <td className=\"py-2 text-center\">\n                                                                        <CButton\n                                                                            color=\"primary\"\n                                                                            variant=\"ghost\"\n                                                                            shape=\"pill\"\n                                                                            size=\"sm\"\n                                                                            onClick={() => this.editEpisode(item)}\n                                                                        >\n                                                                            <CIcon name=\"cilPencil\" size=\"sm\"/>\n                                                                        </CButton>\n                                                                    </td>\n                                                                )\n                                                            }\n                                                    }}\n                                                />\n                                            </CCardBody>\n                                        </CCard>\n                                    </CCol>\n                                )}\n                            </CRow>\n                        )\n                    }\n                </>\n            </Fragment>\n        );\n    }\n\n\n}\n\nexport default Tables\n"],"sourceRoot":""}